[gd_scene load_steps=18 format=3 uid="uid://s8dmi2g1hu2t"]

[ext_resource type="Script" uid="uid://bpaijq7jcidqq" path="res://demo/movable_camera.gd" id="1_d6po2"]
[ext_resource type="AudioStream" uid="uid://cqyh43s2sr7w6" path="res://demo/assets/Lightrays (mastered).mp3" id="2_j5lb4"]
[ext_resource type="SongSettings" uid="uid://dvt7bjcj2njsj" path="res://demo/demo_song_settings.tres" id="2_u10mr"]
[ext_resource type="Script" uid="uid://c1tfxgs78pijt" path="res://demo/fps_meter.gd" id="3_dar0o"]
[ext_resource type="Script" uid="uid://d18hlgoh6wc1" path="res://addons/music_video_generator/src/spectrum/spectrum.gd" id="4_j5lb4"]

[sub_resource type="AnimationSequenceMove" id="AnimationSequenceMove_u10mr"]
end_position = Vector3(0, 0, 10)

[sub_resource type="AnimationSequenceMove" id="AnimationSequenceMove_onu7k"]
end_position = Vector3(0, 10, 0)
look_at_enabled = true
look_at_position = Vector3(10, 0, 0)

[sub_resource type="ImageTexture" id="ImageTexture_5hjng"]

[sub_resource type="SphereMesh" id="SphereMesh_d6po2"]
radius = 1.0
height = 2.0

[sub_resource type="LFOEnvelopeGenerator" id="LFOEnvelopeGenerator_u10mr"]
min_value = -1.0
duration_bars = 1.0
phase_bars = 0.5

[sub_resource type="BeatSequencerEnvelope" id="BeatSequencerEnvelope_u10mr"]

[sub_resource type="Environment" id="Environment_j5lb4"]
background_mode = 3
glow_enabled = true

[sub_resource type="CanvasTexture" id="CanvasTexture_j5lb4"]

[sub_resource type="Gradient" id="Gradient_j5lb4"]
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_u10mr"]
gradient = SubResource("Gradient_j5lb4")
height = 16

[sub_resource type="FastNoiseLite" id="FastNoiseLite_u10mr"]
frequency = 0.0149

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_onu7k"]
noise = SubResource("FastNoiseLite_u10mr")

[node name="Demo" type="Node3D"]

[node name="AnimationRig" type="AnimationRig" parent="."]
song_settings = ExtResource("2_u10mr")
animation_sequences = Array[AnimationSequence]([SubResource("AnimationSequenceMove_u10mr"), SubResource("AnimationSequenceMove_onu7k")])
randomize_sequence_order = true
transform = Transform3D(1, 0, 0, 0, 1, -9.31323e-10, 0, 9.31323e-10, 1, 0, 1.86265e-09, 2.38419e-07)

[node name="RayMarchingCamera" type="RayMarchingCamera" parent="AnimationRig" node_paths=PackedStringArray("output_texture", "music_manager")]
output_texture = NodePath("TextureRect")
music_manager = NodePath("../../MusicManager")
near_plane = 10.0
transform = Transform3D(1, 0, 0, 0, 0.999956, 0.00938973, 0, -0.00938973, 0.999956, 0, 1.01841e-09, 3.09351)
script = ExtResource("1_d6po2")

[node name="TextureRect" type="TextureRect" parent="AnimationRig/RayMarchingCamera"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("ImageTexture_5hjng")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.0857763)
visible = false
mesh = SubResource("SphereMesh_d6po2")

[node name="MusicManager" type="MusicManager" parent="." node_paths=PackedStringArray("audio_stream_player")]
audio_stream_player = NodePath("AudioStreamPlayer")
song_settings = ExtResource("2_u10mr")
envelope_generators = Array[EnvelopeGenerator]([SubResource("LFOEnvelopeGenerator_u10mr"), SubResource("BeatSequencerEnvelope_u10mr")])

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="MusicManager"]
stream = ExtResource("2_j5lb4")
autoplay = true
bus = &"Music"

[node name="Label" type="Label" parent="."]
offset_right = 40.0
offset_bottom = 23.0
script = ExtResource("3_dar0o")

[node name="2DGlow" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_j5lb4")

[node name="Spectrum" type="Node2D" parent="."]
modulate = Color(2, 2, 2, 1)

[node name="Bars" type="Node2D" parent="Spectrum" node_paths=PackedStringArray("reference_node")]
position = Vector2(820, 685)
script = ExtResource("4_j5lb4")
bar_count = 128
reference_node = NodePath("BarsRange")

[node name="BarsRange" type="Sprite2D" parent="Spectrum/Bars"]
modulate = Color(1, 1, 1, 0)
position = Vector2(140, 201.655)
scale = Vector2(1750, 217.773)
texture = SubResource("CanvasTexture_j5lb4")

[node name="Bar" type="Sprite2D" parent="Spectrum"]
position = Vector2(960, 1000)
scale = Vector2(28, 0.933)
texture = SubResource("GradientTexture2D_u10mr")

[node name="Sprite2D" type="Sprite2D" parent="Spectrum"]
visible = false
position = Vector2(384, 353)
texture = SubResource("NoiseTexture2D_onu7k")
